\documentclass[UserManual.tex]{subfiles}
\begin{document}
\setcounter{section}{7}
\section{Template-Based Tutorial}\label{sec:tutorial}

\subsection{Overview}
A template project directory is provided that the User may copy to their own space, then use this as a foundation from which to embark on their own analysis. This directory includes information files, describing the parameter priors and the observables, that correspond to an artificial model that is also provided as a template. Working through the steps in this section constitutes a tutorial, both for running {\it Simplex Sampler} and for running {\it Smooth Emulator}.

This section describes the steps of how the User would
\begin{enumerate}\itemsep=0pt
\item Copy the required files from the template directory to the User's space, and compile the required programs.
\item Set up the information files describing the priors and observable names.
\item Run {\it Simplex Sampler} to generate the model-parameter values at which the full model will be trained.
\item Run an artificial full model to generate the observables for each of the full-model runs.
\item Tune {\it Smooth Emulator} and write the coefficients to file.
\item Run a program that prompts the User for the coordinates of a point in parameter space, then returns the emulator prediction with its uncertainty.
\end{enumerate}

\subsection{Installation}
After completing the necessary prerequisites listed in section \ref{sec:installation}[Installation] and following the steps outlined in section \ref{sec:installation}[Prerequisites] to install the required cmake, eigen, and gsl libraries, and setting the Home Environment Variable by creating the Home Directory as described in section \ref{sec:installation}[Making Home Directory and Setting Home Environment Variable], the user must proceed to clone the smooth and commonutils directories and compile the libraries, as explained in sections \ref{sec:installation}[Downloading] and [Compiling Libraries].

Then, the user can establish a personalized project directory by duplicating the project\_template directory onto their computer. The User needs to copy two directories, {\tt GITHOME\_MSU/smooth/templates/mylocal} and {\tt GITHOME\_MSU/smooth/templates/myproject} to locations in their personal space. We will refer to the User's two new directories as {\tt MY\_LOCAL/} and {\tt MY\_PROJECT/}. For the purpose of this tutorial, the User must compile three programs. This requires first changing into the {\tt MY\_LOCAL/build/} directory and entering:
{\tt
\begin{verbatim}
   MY_LOCAL% cmake .
   MY_LOCAL% make simplex
   MY_LOCAL% make smoothy_tune
   MY_LOCAL% make smoothy_calcobs
\end{verbatim}
}

\subsection{Creating Necessary Info Files}
Before a User can run {\it Simplex Sampler} they must create information files that describe the model-parameter priors and list the observable names. Both files are in the {\tt MY\_PROJECT} directory. The first file is {\tt MY\_PROJECT/Info/prior\_info.txt}. For the purposes of this tutorial, a file already exists,
{\tt
\begin{verbatim}
   par1 uniform      0.000      100.0
   par2 uniform      0.000      100.0
   par3 uniform      0.000      100.0
   par4 uniform      0.000      100.0
\end{verbatim}
}
This implies that the model has four parameters. The names, without much inspiration, are {\tt par1}, {\tt par2}, {\tt par3} and {\tt par4}. These names would normally be more descriptive, e.g. {\tt NuclearCompressibility}. The second entry in each line is either {\tt uniform} or {\tt gaussian}. If the parameter is {\tt uniform}, the last two numbers represent the range of the uniform prior, $x_{\rm min}$ and $x_{\rm max}$. If the second entry is {\tt gaussian} the third entry represents the center of the Gaussian distribution and the fourth represents the width. For a real model, the User would replace this model with one appropriate for their own model.

The second file is {\tt MY\_PROJECT/Info/observable\_info.txt}. This describes output values from the model. In the template the file is
{\tt
\begin{verbatim}
   length   meters   10.0
   mass     kg       30.0
   time     s        25.0
\end{verbatim}
}
The first entry in each line simply provides the names of the observable which will be processed in the Bayesian analysis. The second lists the units, and is never used, but is included for reference. The third entry is only used by {\tt Smooth Emulator} during tuning. The spread, $\sigma_A$, describes the variance of the output due to a single term in the Taylor expansion. Because this is treated as a random variable, and varied from one sampling of the coefficients to another, one must have an initial choice for it before the MCMC procedures in the tuning can proceed. One simple needs to choose this value within a few factors of two from the optimized value. Otherwise, the initial burn-in stage of the MCMC might require more time to coverge in the right neighborhood. Once the burn-in of the MCMC procedure is completed, this parameter is not used. 

\subsection{Step 2: Running {\it Simplex Sampler}}

Both {\it Simplex Sampler} and {\tt Smooth Emulator} have options. These are provided in parameter files. For this tutorial, the provided parameter file is {\tt MY\_PROJECT/parameters/simplex\_parameters.txt}. The provided file is
{\tt
\begin{verbatim}
   #Simplex_LogFileName    simplexlog.txt # comment out to direct output to screen
   Simplex_TrainType       1              # Must be 1 or 2 or 3               
   Simplex_RTrain          0.95           # Radius of simplex    
   Simplex_ModelRunDirName modelruns      # Directory with training pt. info
\end{verbatim}
}
Because the first line is commented, the output of {\it Simplex Sampler} will be to the screen. Otherwise it would go to the specified file. By setting {\tt Simplex\_TrainType=1}, the sampler will choose $n+1$ training points, where $n=4$ is the number of model parameters. Each point corresponds to the vertices of an $n+1$ dimensional simplex. The parameter {\tt Simplex\_RTrain} sets the radius of the simplex, and needs to be less than one for a uniform distribution. The value of 0.95 ensures that the 5 training points are far from one another. Finally, the parameter {\tt Simplex\_ModelRunDirName} is set to ``{\tt modelruns}''. This informs {\tt Simplex Sampler} to write the coordinates of each training point and the corresponding observables in the directory {\tt MY\_PROJECT/modelruns/}. 

Now the user can run {\tt Simplex Sampler}, which must be run from the project directory,
 {\tt
\begin{verbatim}
   ~/MY_PROJECT% MY_LOCAL/bin/simplex parameters/simplex_parameters.txt
\end{verbatim}
}
If all goes, well there is no screen output. The programs writes information about the training points in the {\tt modelruns/} directory. Changing into that directory, there should now be five directories, corresponding to the training points at 5 places: {\tt modelruns/run0}, {\tt modelruns/run1}, {\tt modelruns/run2}, {\tt modelruns/run3}, and {\tt modelruns/run4}. Each directory has one text file describing the training points. For example, the {\tt modelruns/run0/mod\_parameters.txt} file is 
{\tt
\begin{verbatim}
   par1 18.3772
   par2 31.7426
   par3 37.0901
   par4 40
\end{verbatim}
}
This describes the four model parameters, which will serve as the input for the first full model run. If one had set the parameter {\tt Simplex\_TrainType} to 2, there would be 15 sub-directories in {\tt modelruns/}. The next step will be to run the full model for the parameters in each directory. Thus for {\tt Simplex\_Traintype=1}, one would need 5 full-model runs, and for {\tt Simplex\_Traintype=2}, one would need to do 15 full-model runs. The corresponding observables will be written in the files {\tt modelruns/runI/obs.txt}

\subsection{Step 3: Running the Fake Full Model}
Once the training points have been generated, the user will input a Real full model based on the given structure, tailored to address their specific problem. For the tutorial, a fake model is provided. It reads the model-parameter values in each {\tt modelruns/runI/mod_parameters.txt} file and writes the corresponding observables in {\tt modelruns/runI/obs.txt}. 

The fake model is a simple python script, which is enacted by entering the command:
\vspace{-20pt}
{\tt
\begin{verbatim}
   MY_PROJECT% python3 MY_LOCAL/fakemodel/templatemod.py
\end{verbatim}
}
The output should appear as
\vspace{-20pt}
{\tt
\begin{verbatim}
   MY_PROJECT% python3 MY_LOCAL/fakemodel/templatemod.py
   MY_PROJECT% Writing: length 10.871583624279312 1.0
   MY_PROJECT% Writing: mass -48.906793378963606 1.0
   MY_PROJECT% Writing: time -50.76565279455246 1.0

   MY_PROJECT% Writing: length -27.67701646408149 1.0
   MY_PROJECT% Writing: mass -50.35567713223607 1.0
   MY_PROJECT% Writing: time -34.04264570717603 1.0
   .
   .
\end{verbatim}
}
Inspecting the {\tt modelruns/run0/obs.txt} file,
\vspace{-20pt}
{\tt
\begin{verbatim}
   length 10.871583624279312 1.0
   mass -48.906793378963606 1.0
   time -50.76565279455246 1.0
\end{verbatim}
}
The second entry of each line is the value of the specified observable for that specific training point. The last entry is the random uncertainty associated with the full model. This is only relevant if the model has random fluctuations, meaning the re-running the model at the same point might result in different output. For this tutorial, the emulator will not consider such fluctuations (there is an emulator parameter that can be set to either consider the randomness or ignore it), so the third entry on each line is superfluous.

\subsection{Step 4: Running {\it Smooth Emulator}}
To compile the tuning program, User should navigate to {\tt GITHOME\_MSU/smooth/local/build/} directory and execute the following commands.
{\tt
\begin{verbatim}
 ~/GITHOME_MSU/smooth/local/build % cmake .
 ~/GITHOME_MSU/smooth/local/build % make smoothy_tune
\end{verbatim}
}
The executable {\tt smoothy\_tune} should now appear in the {\tt GITHOME\_MSU/smooth/local/bin/} directory. After the addition of the {\tt bin/} directory to the User's path, the User may switch to the User's project directory, and enter the command
{\tt
\begin{verbatim}
  ~/MY_PROJECT % GITHOME_MSU/smooth/local/bin/smoothy_tune PARAMETERS/MY_PARAMETERS.TXT
\end{verbatim}
}
In the above, {\tt GITHOME\_MSU} is the path of the {\it Smooth Emulator} installation. {\tt PROJECT\_TEMPLATE}, and {\tt PARAMETERS/emulator\_parameters.txt} would be replaced by the User.

The program generates Taylor coefficients for $N_{\rm sample}$ samples and saves them in the {\tt coefficients} directory. Each observable has its own subdirectory with its name. Besides the coefficients, {\it Smooth Emulator} also produces a {\tt meta.txt} file in the same directory. It includes essential information like the observable's maximum rank and net number of model parameters. This file can be used to access the coefficients later.

{\it Smooth Emulator} offers progress updates throughout its execution, which may appear on the screen or be saved to a file, depending on the settings established in the SmoothEmulator\_LogFile parameter. The progress report encompasses data on the success rate of the MCMC program. Specifically, the line BestLogP/Ndof represents the weight utilized to assess the likelihood of a coefficients sample. It is worth noting that this value should converge roughly when the Metropolis procedure settles on the most probable region. For Further understanding refer to section \ref{sec:emulator}{Tuning the Emulator}

\end{document}
